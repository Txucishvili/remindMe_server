!function(e){var n={};function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,n,t){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)r.d(t,a,function(n){return e[n]}.bind(null,a));return t},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="",r(r.s=17)}([function(e,n){e.exports=require("apollo-server-express")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("axios")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n){e.exports=require("node-fetch")},function(e,n){e.exports=require("graphql")},function(e,n){e.exports=require("bcrypt-nodejs")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("request")},function(e,n){e.exports=require("cheerio")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("graphql-tools")},function(e,n){e.exports=require("merge-graphql-schemas")},function(e,n){e.exports=require("color-thief")},function(e,n){e.exports=require("color")},function(e,n,r){r(18),e.exports=r(22)},function(e,n){e.exports=require("babel-polyfill")},function(e,n){e.exports=require("http")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("file-saver")},function(e,n,r){"use strict";r.r(n);var t=r(3),a=r.n(t),i=r(8),o=r.n(i),u=(r(19),r(9)),s=r.n(u),c=r(1),f=r.n(c),d=r(0),l=r(4),p=r.n(l),v=(a.a.Router(),r(5)),g=r.n(v),m=r(2),h=r.n(m);r(10),r(11);function b(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function y(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?b(Object(r),!0).forEach((function(n){w(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function w(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function x(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function S(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){x(i,t,a,o,u,"next",e)}function u(e){x(i,t,a,o,u,"throw",e)}o(void 0)}))}}var k=function(e){var n="https://api.imovies.cc/api/v1/movies/"+e;return new Promise(function(){var e=S(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get(n).then((function(e){r(e.data.data)})).catch((function(e){t(e)}));case 2:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}())},R=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={without_watched_movies:"no",countries_related:"no",genres_related:"no",filter_type:"movie",keywords:encodeURIComponent(n.title),page:1,per_page:9},t=function(e){var n="https://api.imovies.cc/api/v1/search-advanced?movie_filters%5Bgenres_related%5D="+e.genres_related+"&movie_filters%5Bcountries_related%5D="+e.countries_related+"&movie_filters%5Bwithout_watched_movies%5D="+e.without_watched_movies+"&filters%5Btype%5D="+e.filter_type+"&keywords="+e.keywords+"&page="+e.page+"&per_page="+e.per_page;return JSON.parse(JSON.stringify(n))}(r),e.abrupt("return",new Promise(function(){var e=S(regeneratorRuntime.mark((function e(n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get(t).then((function(e){var r=e&&e.data?e.data.data:[];n(r?{error:!1,errorType:0,data:r}:{error:!0,errorType:1,data:[]})})).catch((function(e){r({error:!0,errorType:1,data:e})}));case 2:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(n).then((function(e){return e})).catch((function(e){return e}));case 2:if(a=e.sent,t=a,a.error||!a.data){e.next=16;break}if(!(r=a.data.find((function(e){if(e.id&&e.secondaryName.toLowerCase().replace(/\.+/g," ").replace(/\s+/g,"_").includes(n.title.toLowerCase().replace(/w!+/g,"").replace(/\s+/g,"_"))&&e.year===n.release_date)return e})))){e.next=13;break}return e.next=9,k(r.id);case 9:t.data=e.sent,t.errorType=0,e.next=16;break;case 13:t.error=!0,t.errorType=2,t.data=[];case 16:return e.abrupt("return",new Promise((function(e){e(y({},t,{id:n.id}))})));case 17:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(e){var n="https://api.adjaranet.com/api/v1/search-advanced?movie_filters%5Bwith_actors%5D=3&movie_filters%5Bwith_directors%5D=1&filters%5Btype%5D=movie&keywords="+encodeURIComponent(e.title.toLowerCase());return new Promise(function(){var e=S(regeneratorRuntime.mark((function e(r,t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get(n).then((function(e){var n=e&&e.data&&e.data.data?e.data.data:[];r(n?{error:!1,errorType:0,data:n}:{error:!0,errorType:1,data:[]})})).catch((function(e){t({error:!0,errorType:1,data:e})}));case 2:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}())},j=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,t="https://api.adjaranet.com/api/v1/movies/"+r,e.next=4,h.a.get(t).then((function(e){return e.data.data||[]})).catch((function(e){return{error:e}}));case 4:return a=e.sent,e.abrupt("return",new Promise((function(e){a.error?e({error:!0,isAdded:null,data:null}):e({error:!1,isAdded:!!a.seasons&&!!a.seasons.data.length,data:a})})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),I=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,t,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(n).then((function(e){return e})).catch((function(e){return e}));case 2:if(a=e.sent,t=a,a.error||!a.data){e.next=11;break}if(!(r=a.data.find((function(e){if(e.id&&e.year===n.release_date&&e.secondaryName.toLowerCase().replace(/\.+/g," ").replace(/\s+/g,"_").includes(n.title.toLowerCase().replace(/w!+/g,"").replace(/\s+/g,"_")))return e})))){e.next=10;break}return e.next=9,j({id:r.id});case 9:i=e.sent;case 10:r?(t.isAdded=i.isAdded,t.errorType=0,t.data=i.data):(t.error=!0,t.errorType=2,t.data=[]);case 11:return e.abrupt("return",new Promise((function(e){e(y({},t,{id:n.id}))})));case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),P=function(){var e=S(regeneratorRuntime.mark((function e(n){var r,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={id:n.id,iMovie:{id:null,isAdded:!1},iMDb:null,adjaranet:{id:null,isAdded:!1},valid:!1,error:!1},e.next=3,_(n);case 3:return t=e.sent,e.next=6,I(n);case 6:return a=e.sent,!t.error&&t.data.id&&(r.iMovie={id:t.data.id,isAdded:!(!t.data.seasons||!t.data.seasons.data.length)},r.iMDb=t.data.imdbUrl),!a.error&&a.data.id&&(console.log("adjaranetResult",a),r.adjaranet={global_id:a.data.id,id:a.data.adjaraId,isAdded:a.isAdded}),e.abrupt("return",r);case 10:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();"https://api.themoviedb.org/3/movie/now_playing?api_key=".concat("def8e81a2062de92fa98fd4763e2c128","&language=en-US&page=1");var T=r(7),A=r.n(T),N=r(12),D=r.n(N);r(20);console.log("--",".env.".concat("production").toString());var M=D.a.config({path:".env.production"});if(M.error)throw M.error;M.parsed;var U,E=M.parsed;function q(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function C(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){q(i,t,a,o,u,"next",e)}function u(e){q(i,t,a,o,u,"throw",e)}o(void 0)}))}}function B(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}U={isDevelopment:"development"===E.NODE_ENV};var F=function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)};B(F,"saltRounds",E.TOKEN_SALT),B(F,"secret",E.TOKEN_SECRET),B(F,"issuer",E.TOKEN_ISSUER),B(F,"audience",E.TOKEN_AUDIENCE),B(F,"jsonDecode",function(){var e=C(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},e.next=3,p.a.decode(n,F.secret,{issuer:F.issuer,audience:F.audience},(function(e,n){return n}));case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),B(F,"checkUser",function(){var e=C(regeneratorRuntime.mark((function e(n,r){var t,a,i,o,u,s,c,f,d,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("null"!==(t=n.authorization||"")){e.next=5;break}a={error:!0,type:0},e.next=18;break;case 5:return e.next=7,F.jsonDecode(t);case 7:if(!(i=e.sent)){e.next=14;break}return e.next=11,r.Users.findById(i.id);case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=!1;case 15:o=e.t0,u=!!i&&Date.now()>=1e3*i.exp,i?u?a={error:!0,type:2}:o?(s=o.firstName,c=o.lastName,f=o._id,d=o.email,l=o.l_status,a={error:!1,type:null,data:{firstName:s,lastName:c,email:d,l_status:l,id:f.toString()}}):a={error:!0,type:3}:a={error:!0,type:1};case 18:return e.abrupt("return",new Promise((function(e){e(a)})));case 19:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}()),B(F,"genSalt",(function(e){return A.a.genSaltSync(e)})),B(F,"genHash",(function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F.saltRounds,r=F.genSalt(n);return A.a.hashSync(e,r)})),B(F,"comparePassword",(function(e,n){return A.a.compareSync(e,n)})),B(F,"genToken",(function(e,n){Math.floor(Date.now()/1e3);return p.a.sign(e,F.secret,{issuer:F.issuer,audience:F.audience,expiresIn:"10m"})}));var L=F;function z(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}var Q={router:"/api/auth/refreshToken",middleware:[],handling:function(){var e,n=(e=regeneratorRuntime.mark((function e(n,r){var t,a,i,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.query.oldToken,e.next=3,L.jsonDecode(t);case 3:return a=e.sent,i={id:a.id,roles:a.rules},o=Math.floor(Date.now()/1e3)+3600,e.next=8,L.genToken(i,o);case 8:u=e.sent,r.send({token:u});case 10:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){z(i,t,a,o,u,"next",e)}function u(e){z(i,t,a,o,u,"throw",e)}o(void 0)}))});return function(e,r){return n.apply(this,arguments)}}()};var H=a.a.Router();H.use(Q.router,Q.middleware,Q.handling);var J=H,W=r(13),K=r(14);function V(){var e=function(e,n){n||(n=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}(["\n    type User {\n        _id: String\n        firstName: String\n        lastName: String\n        email: String\n        password: String\n        created: String\n        modified: String\n    }\n\n    type UserResponse {\n        firstName: String!,\n        lastName: String!\n        email: String!,\n        auth: Token,\n        l_status: String\n    }\n\n    type Query {\n        AllUsers: [User]! @isAuth @roles(requires: ADMIN)\n        getUser(id: String!): UserResponse  @isAuth @roles(requires: ADMIN)\n        me: UserResponse @isAuth\n    }\n\n    type SignInResponse {\n        firstName: String!,\n        lastName: String!\n        email: String!,\n        auth: Token,\n        l_status: String\n    }\n\n    input SignUpInput {\n        firstName: String!,\n        lastName: String!\n        email: String!,\n        password: String!\n        created: String!\n    }\n"]);return V=function(){return e},e}var G=Object(d.gql)(V());function X(){var e=function(e,n){n||(n=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}(["\n    directive @isAuth on FIELD_DEFINITION\n    directive @roles(\n        requires: Roles = ADMIN,\n    ) on OBJECT | FIELD_DEFINITION\n\n    enum Roles {\n        ADMIN\n        USER\n        FRIEND\n    }\n\n    input SignInInput {\n        email: String!\n        password: String!\n    }\n\n    input SignUpInput {\n        firstName: String!,\n        lastName: String!\n        email: String!,\n        password: String!\n        created: String!\n    }\n\n    type Token {\n        token: String!\n    }\n\n    type SignInResponse {\n        firstName: String!,\n        lastName: String!\n        email: String!,\n        auth: Token,\n        l_status: String\n    }\n    \n    type LogOutResponse {\n        data: String\n    }\n    \n    type Query {\n        logOut: LogOutResponse\n    }\n\n    type Mutation {\n        signUp(data: SignUpInput!): SignInResponse!\n        signIn(data: SignInInput!): SignInResponse!\n    }\n"]);return X=function(){return e},e}var Y=Object(d.gql)(X());function Z(){var e=function(e,n){n||(n=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}(["  \n    type ResultObjItem {\n        id: String,\n        isAdded: Boolean\n    }\n\n    type ResultObj {\n        adjaranet: ResultObjItem,\n        iMDb: String,\n        iMovie: ResultObjItem\n    }\n\n    type PostersObject {\n        aspect_ratio: String,\n        file_path: String,\n        height: String,\n        width: String,\n    }\n\n    type TrailerObject {\n        key: String,\n        name: String,\n        site: String,\n        size: String,\n        type: String,\n    }\n\n    type CastPersonObject {\n        cast_id: String,\n        character: String,\n        credit_id: String,\n        gender: String,\n        id: String,\n        order: String,\n        name: String,\n        profile_path: String,\n    }\n    \n    type TheaterItem {\n        movieId: String,\n        adult: String,\n        backdrop_path: String,\n        original_language: String,\n        original_title: String,\n        title: String,\n        overview: String,\n        popularity: String,\n        release_date: String,\n        video: String,\n        vote_average: String,\n        vote_count: String,\n        poster_path: String,\n        posters: [PostersObject],\n        trailers: [TrailerObject],\n        genre_ids: [String],\n        isAvailable: Boolean,\n        color: String,\n        cast: [CastPersonObject],\n        searchResult: FinderResultObject\n    }\n    \n    input fetchInputConfig {\n        finder: Boolean\n    }\n\n    type Query {\n        updateTheater: [TheaterItem]! @isAuth @roles(requires: ADMIN)\n        fetchTheater(data: fetchInputConfig): [TheaterItem]! @isAuth\n        fetchItem(id: String): TheaterItem! @isAuth\n        fetchMovieList: [TheaterItem]! @isAuth\n    }\n"]);return Z=function(){return e},e}var $=Object(d.gql)(Z());function ee(){var e=function(e,n){n||(n=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}(["\n    input SetReminderConfigurations {\n        sms: Boolean,\n        email: Boolean\n    }\n\n    type SetReminderConfigurationsType {\n        sms: Boolean,\n        email: Boolean\n    }\n\n    input setReminderInput {\n        movieId: String!,\n        showable: Boolean,\n        configuration: SetReminderConfigurations!,\n    }\n    \n    type setReminderOutput {\n        userId: String\n        movieId: String,\n        configuration: SetReminderConfigurationsType,\n        createdAt: String,\n        updatedAt: String\n    }\n    \n    type AvaialablePlatformItem {\n        id: String,\n        url: String,\n        isAdded: Boolean\n    }\n    \n    type AvaialablePlatformsObject {\n        adjaranet: AvaialablePlatformItem,\n        iMovie: AvaialablePlatformItem\n    }\n    \n    type getReminderOutput {\n        _id: String,\n        userId: String\n        movieId: String,\n        showable: Boolean,\n        configuration: SetReminderConfigurationsType,\n        isAvaialable: Boolean,\n        platforms: AvaialablePlatformsObject,\n        createdAt: String,\n        updatedAt: String\n    }\n\n    type setReminder_response {\n        data: setReminderOutput,\n        message: String\n    }\n\n    type Mutation {\n        setReminder(data: setReminderInput): setReminder_response\n    }\n    \n    type Query {\n        getReminders: [getReminderOutput]\n    }\n"]);return ee=function(){return e},e}var ne=Object(d.gql)(ee());function re(){var e=function(e,n){n||(n=e.slice(0));return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}(["  \n    type FinderResultItemObject {\n        global_id: String,\n        id: String,\n        isAdded: Boolean,\n    }\n\n    type FinderResultObject {\n        movieId: String,\n        adjaranet: FinderResultItemObject,\n        iMDb: String,\n        iMovie: FinderResultItemObject\n    }\n\n    type Query {\n        updateFinder: [FinderResultObject]! @isAuth @roles(requires: ADMIN)\n    }\n"]);return re=function(){return e},e}var te=[G,Y,$,Object(d.gql)(re()),ne],ae=Object(K.mergeTypes)(te,{all:!0}),ie=function(e){return function(n,r,t,a){if(!t.user)throw new Error("Unauthenticated!");return e(n,r,t,a)}},oe=function(e){return function(n){return function(r,t,a,i){if(a.user.role!==e)throw new Error("Unauthorized!");return n(r,t,a,i)}}};function ue(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function se(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){ue(i,t,a,o,u,"next",e)}function u(e){ue(i,t,a,o,u,"throw",e)}o(void 0)}))}}var ce={Query:{AllUsers:ie(oe("ADMIN")(function(){var e=se(regeneratorRuntime.mark((function e(n,r,t){var a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.db,e.next=3,a.Users.find();case 3:return i=e.sent,o=i.map((function(e){return e._id=e._id.toString(),e})),e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}())),getUser:ie(oe("ADMIN")(function(){var e=se(regeneratorRuntime.mark((function e(n,r,t){var a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.db,e.next=3,a.Users.findById(r.id);case 3:return i=e.sent,o={firstName:i.firstName,lastName:i.lastName,email:i.email,l_visit:i.l_visit},e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}())),me:ie(function(){var e=se(regeneratorRuntime.mark((function e(n,r,t){var a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.db.Users.findById(t.user.id);case 2:return a=e.sent,i=t.user?L.genToken({id:t.user.id}):"",o={firstName:a.firstName,lastName:a.lastName,email:a.email,auth:{token:i},l_visit:a.l_visit},e.abrupt("return",o);case 6:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}())},Mutation:{}};function fe(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function de(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){fe(i,t,a,o,u,"next",e)}function u(e){fe(i,t,a,o,u,"throw",e)}o(void 0)}))}}var le,pe,ve,ge={Query:{logOut:(ve=de(regeneratorRuntime.mark((function e(n,r,t){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.args,a=t.user,t.db,console.log("user._id",a),e.abrupt("return",{data:"successfully logged out"});case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return ve.apply(this,arguments)})},Mutation:{signUp:(pe=de(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s,c,f,l,p,v,g,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.data,t.user,i=t.db,console.log("signUp Hit"),o=a.firstName,u=a.lastName,s=a.email,c=a.password,e.next=6,i.Users.findOne({email:s});case 6:if(!e.sent){e.next=9;break}throw new Error({type:1,message:"User already exist"});case 9:return e.next=11,L.genHash(c);case 11:return f=e.sent,l={firstName:o,lastName:u,password:f,email:s},e.next=15,new i.Users(l).save();case 15:if((p=e.sent)._id=p._id.toString(),p){e.next=19;break}throw new d.UserInputError("Smth goes wrong");case 19:return v={id:p._id,roles:[]},g=Math.floor(Date.now()/1e3)+3600,e.next=23,L.genToken(v,g);case 23:return m=e.sent,h=p?m:null,e.abrupt("return",{firstName:p.firstName,lastName:p.lastName,email:p.email,l_visit:p.l_visit,auth:{token:h}});case 26:case"end":return e.stop()}}),e)}))),function(e,n,r){return pe.apply(this,arguments)}),signIn:(le=de(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s,c,f,l,p,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.data,i=t.db,o=a.email,u=a.password,!o){e.next=9;break}return e.next=6,i.Users.findOne({email:o});case 6:e.t0=e.sent,e.next=10;break;case 9:e.t0=!1;case 10:if(!(s=e.t0)){e.next=17;break}return e.next=14,L.comparePassword(u,s.password);case 14:e.t1=e.sent,e.next=18;break;case 17:e.t1=!1;case 18:if(c=e.t1,console.log("passwordMatches",c),s){e.next=24;break}return e.abrupt("return",new d.UserInputError("User not found"));case 24:if(c){e.next=26;break}return e.abrupt("return",new d.UserInputError("Invalid credentials"));case 26:return f={id:s._id,roles:[]},l=Math.floor(Date.now()/1e3)+3600,e.next=30,L.genToken(f,l);case 30:return p=e.sent,v=s?p:null,e.abrupt("return",{firstName:s.firstName,lastName:s.lastName,email:s.email,l_visit:s.l_visit,auth:{token:v}});case 33:case"end":return e.stop()}}),e)}))),function(e,n,r){return le.apply(this,arguments)})}},me=function(e){return new Promise((function(n){setTimeout((function(){n()}),e)}),e)};function he(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function be(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){he(i,t,a,o,u,"next",e)}function u(e){he(i,t,a,o,u,"throw",e)}o(void 0)}))}}var ye=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return n.keywords&&console.log("config is"-n),new Promise(function(){var r=be(regeneratorRuntime.mark((function r(t,a){var i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,g()(e,n).then((function(e){return e})).catch((function(e){return e}));case 2:if(!(i=r.sent)){r.next=9;break}return r.next=6,i.json();case 6:r.t0=r.sent,r.next=10;break;case 9:r.t0=[];case 10:o=r.t0,200===i.status?t(o):a(o);case 13:case"end":return r.stop()}}),r)})));return function(e,n){return r.apply(this,arguments)}}())},we=("https://api.themoviedb.org/3/movie/now_playing?api_key=".concat("def8e81a2062de92fa98fd4763e2c128","&language=en-US&page=1"),{key:"def8e81a2062de92fa98fd4763e2c128",lang:"en",trailerType:"Trailer"}),xe=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r="https://api.themoviedb.org/3".concat(e,"?api_key=").concat(we.key,"&language=").concat(we.lang).concat(n);return r},Se=function(){var e=be(regeneratorRuntime.mark((function e(n){var r,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.id,t=n.target,e.next=3,ye(xe("/movie/".concat(r,"/").concat(t))).then((function(e){return console.log("[fetchHandler] fetched data - ".concat(t," - "),e),{error:!1,data:e}})).catch((function(e){return console.log("[fetchHandler] error on - ".concat(t," - "),e),{error:!0,data:e}}));case 3:return a=e.sent,e.abrupt("return",new Promise((function(e,n){a.error?n(a):e(a)})));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();function ke(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}var Re=function(){var e,n=(e=regeneratorRuntime.mark((function e(){var n,r,t,a,i,o,u,s,c,f,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,ye(xe("/movie/now_playing","&page=1")).then((function(e){return e})).catch((function(e){return e}));case 3:if((r=e.sent).results.map((function(e){return n.push(e)})),!r||!r.total_pages){e.next=16;break}t=1;case 7:if(!(t<4)){e.next=16;break}if(!(t>1)){e.next=13;break}return e.next=11,ye(xe("/movie/now_playing","&page="+t)).then((function(e){return e})).catch((function(e){return e}));case 11:(a=e.sent).results&&(console.log("- catch next page - ",t,a.results.length),a.results.map((function(e){return n.push(e)})));case 13:t++,e.next=7;break;case 16:i=0,o=n;case 17:if(!(i<o.length)){e.next=44;break}return u=o[i],s=n.indexOf(u),c=300,f=void 0,d=void 0,e.next=26,me(c);case 26:return e.next=28,Se({id:u.id,target:"images"}).then((function(e){return e.data})).catch((function(e){return[]}));case 28:return f=e.sent,e.next=31,me(c);case 31:return e.next=33,Se({id:u.id,target:"videos"}).then((function(e){return e.data})).catch((function(e){return[]}));case 33:return d=e.sent,e.next=36,me(c);case 36:return e.next=38,Se({id:u.id,target:"credits"}).then((function(e){return e.data.cast.filter((function(e){return e.order<9}))})).catch((function(e){return[]}));case 38:e.sent,n[s].posters=f.posters,n[s].trailers=d.results.filter((function(e){if(e.type.toLowerCase()===we.trailerType.toLowerCase())return e}));case 41:i++,e.next=17;break;case 44:return console.log("allPagesCollect - ",n),e.abrupt("return",n);case 46:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){ke(i,t,a,o,u,"next",e)}function u(e){ke(i,t,a,o,u,"throw",e)}o(void 0)}))});return function(){return n.apply(this,arguments)}}(),_e=r(15),Oe=r.n(_e),je=r(16),Ie=r.n(je);function Pe(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function Te(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){Pe(i,t,a,o,u,"next",e)}function u(e){Pe(i,t,a,o,u,"throw",e)}o(void 0)}))}}var Ae=function(e){var n=Number(e).toString(16);return n.length<2&&(n="0"+n),n},Ne=function(e){return"#"+(n=e[0],r=e[1],t=e[2],Ae(n)+Ae(r)+Ae(t));var n,r,t},De=function(e,n){var r=parseInt(e.replace("#",""),16),t=Math.round(2.55*n),a=(r>>16)+t,i=(r>>8&255)+t,o=(255&r)+t;return(16777216+65536*(a<255?a<1?0:a:255)+256*(i<255?i<1?0:i:255)+(o<255?o<1?0:o:255)).toString(16).slice(1)},Me=function(){var e=Te(regeneratorRuntime.mark((function e(n){var r,t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get(n,{responseType:"arraybuffer"}).then((function(e){return e.data}));case 2:return r=e.sent,t=Buffer.from(r),Uint8Array.from(t).buffer,e.abrupt("return",new Promise((function(e){return e(r)})));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Ue=function(){var e=Te(regeneratorRuntime.mark((function e(n){var r,t,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Me(n);case 2:return r=e.sent,t=new Oe.a,t.getColor(r),a=t.getPalette(r,6),i=a.map((function(e){return{isLight:Ie()(e).isLight(),lighten:De(Ne(e),.2),hex:Ne(e)}})),o=i,e.abrupt("return",o);case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),Ee=function(){var e=Te(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(n);case 2:return r=e.sent,e.abrupt("return",new Promise((function(e){return e(r)})));case 4:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();function qe(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function Ce(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){qe(i,t,a,o,u,"next",e)}function u(e){qe(i,t,a,o,u,"throw",e)}o(void 0)}))}}r(21);var Be={Query:{updateTheater:ie(function(){var e=Ce(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s,c,f,d,l,p,v,g,m,h,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.user,a=t.db,e.next=3,Re();case 3:i=e.sent,u=i.map((function(e){return e.movieId=e.id,delete e.id,e})),s=!0,c=!1,f=void 0,e.prev=8,d=u[Symbol.iterator]();case 10:if(s=(l=d.next()).done){e.next=37;break}return p=l.value,v=p.movieId,console.log("item [CATCH] - ",p),e.next=16,a.Theater.findOne({movieId:v});case 16:if(o=e.sent,(g=p).isAvailable=!1,!p.poster_path){e.next=28;break}return m="https://image.tmdb.org/t/p/original".concat(p.poster_path),e.next=23,Ee(m).then((function(e){return e}));case 23:(h=e.sent).filter((function(e){return e.isLight})),g.color=h[0].hex,e.next=29;break;case 28:g.color=null;case 29:if(o){e.next=34;break}return console.log("item not found in DB - ",p.title),e.next=33,new a.Theater(g).save();case 33:o=e.sent;case 34:s=!0,e.next=10;break;case 37:e.next=43;break;case 39:e.prev=39,e.t0=e.catch(8),c=!0,f=e.t0;case 43:e.prev=43,e.prev=44,s||null==d.return||d.return();case 46:if(e.prev=46,!c){e.next=49;break}throw f;case 49:return e.finish(46);case 50:return e.finish(43);case 51:return e.next=53,a.Theater.find();case 53:return b=e.sent,console.log("------- DONE"),e.abrupt("return",b);case 56:case"end":return e.stop()}}),e,null,[[8,39,43,51],[44,,46,50]])})));return function(n,r,t){return e.apply(this,arguments)}}()),fetchTheater:ie(function(){var e=Ce(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s,c,f,d,l,p,v,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.user,a=t.db,i=[],e.next=4,a.Theater.find();case 4:if(e.sent,!r.data||!r.data.finder){e.next=41;break}return e.next=8,a.FinderModel.find();case 8:o=e.sent,u=!0,s=!1,c=void 0,e.prev=12,f=o[Symbol.iterator]();case 14:if(u=(d=f.next()).done){e.next=25;break}if(!(l=d.value).adjaranet.isAdded&&!l.iMovie.isAdded){e.next=22;break}return p=l.movieId,e.next=20,a.Theater.findOne({movieId:p});case 20:(v=e.sent)&&((g=JSON.parse(JSON.stringify(v))).searchResult=l,i.push(g));case 22:u=!0,e.next=14;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(12),s=!0,c=e.t0;case 31:e.prev=31,e.prev=32,u||null==f.return||f.return();case 34:if(e.prev=34,!s){e.next=37;break}throw c;case 37:return e.finish(34);case 38:return e.finish(31);case 39:e.next=44;break;case 41:return e.next=43,a.Theater.find({isAvailable:!1});case 43:i=e.sent;case 44:return e.abrupt("return",i);case 45:case"end":return e.stop()}}),e,null,[[12,27,31,39],[32,,34,38]])})));return function(n,r,t){return e.apply(this,arguments)}}()),fetchItem:ie(function(){var e=Ce(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.user,a=t.db,i={},o=r.id,e.next=5,a.Theater.findOne({movieId:o});case 5:if(u=e.sent,console.log("args",r),u){e.next=9;break}throw new Error("No movie found");case 9:return console.log("movie id",r),console.log("foundItems",u),e.next=13,Se({id:o,target:"credits"}).then((function(e){return e.data.cast.filter((function(e){return e.order<9}))})).catch((function(e){return[]}));case 13:return s=e.sent,(i=u).cast=s,e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}())}};function Fe(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function Le(e){return function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){Fe(i,t,a,o,u,"next",e)}function u(e){Fe(i,t,a,o,u,"throw",e)}o(void 0)}))}}var ze={Query:{getReminders:ie(function(){var e=Le(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.user,i=t.db,e.next=3,i.Reminders.find({userId:a.id});case 3:return o=e.sent,u=o.map((function(e){return e._id=e._id.toString(),e._doc})),e.abrupt("return",u);case 6:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}())},Mutation:{setReminder:ie(function(){var e=Le(regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s,c,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.user,i=t.db,u={userId:a.id,movieId:r.data.movieId,showable:r.data.showable,configuration:r.data.configuration,createdAt:(new Date).getTime(),updatedAt:null},s={data:{}},e.next=5,i.Reminders.find({userId:a.id});case 5:return c=e.sent,e.next=8,c.find((function(e){return e.movieId===u.movieId}));case 8:if(f=e.sent){e.next=16;break}return e.next=12,i.Reminders(u).save();case 12:o=e.sent,s.message="saved",e.next=18;break;case 16:o=f,s.message="you have added this movie in ReminderList";case 18:return console.log("saveReminder",o),s.data={userId:o.userId,movieId:o.movieId,configuration:o.configuration,createdAt:o.createdAt,showable:o.showable},e.abrupt("return",s);case 21:case"end":return e.stop()}}),e)})));return function(n,r,t){return e.apply(this,arguments)}}())}};function Qe(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}var He=[ce,ge,Be,{Query:{updateFinder:ie(function(){var e,n=(e=regeneratorRuntime.mark((function e(n,r,t){var a,i,o,u,s,c,f,d,l,p,v,g,m,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.user,a=t.db,e.next=3,a.Theater.find();case 3:i=e.sent,o=!0,u=!1,s=void 0,e.prev=7,c=i[Symbol.iterator]();case 9:if(o=(f=c.next()).done){e.next=34;break}return d=f.value,l=d.movieId,e.next=14,a.FinderModel.findOne({movieId:l});case 14:return p=e.sent,v=void 0,g={id:d.movieId,title:d.title,release_date:parseInt(d.release_date.split("-")[0],10)},e.next=19,P(g);case 19:if("423204"===(v=e.sent).id?v.adjaranet={isAdded:!0}:"423204"===v.id&&(v.iMovie={isAdded:!0}),m={movieId:v.id,adjaranet:v.adjaranet,iMovie:v.iMovie,iMDb:v.iMDb},p){e.next=26;break}return e.next=25,new a.FinderModel(m).save();case 25:p=e.sent;case 26:if(!p.adjaranet.isAdded&&!p.iMovie.isAdded){e.next=30;break}return console.log("catch updates",l),e.next=30,a.Theater.update({movieId:l},{isAvailable:!0},(function(e,n){e&&console.log("err",e),console.log("resp",n)}));case 30:!p.adjaranet.isAdded&&m.adjaranet.isAdded?console.log("adjaranet catches ",d.title):!p.iMovie.isAdded&&m.iMovie.isAdded&&console.log("iMovie catches ",d.title);case 31:o=!0,e.next=9;break;case 34:e.next=40;break;case 36:e.prev=36,e.t0=e.catch(7),u=!0,s=e.t0;case 40:e.prev=40,e.prev=41,o||null==c.return||c.return();case 43:if(e.prev=43,!u){e.next=46;break}throw s;case 46:return e.finish(43);case 47:return e.finish(40);case 48:return e.next=50,a.FinderModel.find();case 50:return h=e.sent,e.abrupt("return",h);case 52:case"end":return e.stop()}}),e,null,[[7,36,40,48],[41,,43,47]])})),function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){Qe(i,t,a,o,u,"next",e)}function u(e){Qe(i,t,a,o,u,"throw",e)}o(void 0)}))});return function(e,r,t){return n.apply(this,arguments)}}())}},ze],Je=r(6);function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ke(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function Ve(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function Ge(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Xe(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function Ye(e,n){return!n||"object"!==We(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function Ze(e){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function $e(e,n){return($e=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var en=function(e){function n(){return Ge(this,n),Ye(this,Ze(n).apply(this,arguments))}var r,t,a;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&$e(e,n)}(n,e),r=n,(t=[{key:"visitFieldDefinition",value:function(e){var n=this,r=e.resolve,t=void 0===r?Je.defaultFieldResolver:r;e.resolve=function(){var e,r=(e=regeneratorRuntime.mark((function e(){var r,a,i,o,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=u.length,a=new Array(r),i=0;i<r;i++)a[i]=u[i];if(root=a[0],Ke(a[1]),a[2].user){e.next=7;break}return console.warn("User not authenticated"),e.abrupt("return",{});case 7:return e.next=9,t.apply(n,a);case 9:return o=e.sent,e.abrupt("return",o);case 11:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(t,a){var i=e.apply(n,r);function o(e){Ve(i,t,a,o,u,"next",e)}function u(e){Ve(i,t,a,o,u,"throw",e)}o(void 0)}))});return function(){return r.apply(this,arguments)}}()}}])&&Xe(r.prototype,t),a&&Xe(r,a),n}(d.SchemaDirectiveVisitor);function nn(e){return(nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rn(e){if(null==e)throw new TypeError("Cannot destructure undefined")}function tn(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}function an(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function on(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function un(e,n){return!n||"object"!==nn(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function sn(e){return(sn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function cn(e,n){return(cn=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}var fn=function(e){function n(){return an(this,n),un(this,sn(n).apply(this,arguments))}var r,t,a;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&cn(e,n)}(n,e),r=n,(t=[{key:"visitObject",value:function(e){this.ensureFieldsWrapped(e),e._requiredAuthRole=this.args.requires}},{key:"visitFieldDefinition",value:function(e,n){this.ensureFieldsWrapped(n.objectType),e._requiredAuthRole=this.args.requires}},{key:"ensureFieldsWrapped",value:function(e){var n=this;if(!e._authFieldsWrapped){e._authFieldsWrapped=!0;var r=e.getFields();Object.keys(r).forEach((function(t){var a=r[t],i=a.resolve,o=void 0===i?Je.defaultFieldResolver:i;a.resolve=function(){var r,t=(r=regeneratorRuntime.mark((function r(){var t,i,u,s,c,f,d,l=arguments;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:for(t=a._requiredAuthRole||e._requiredAuthRole,i=l.length,u=new Array(i),s=0;s<i;s++)u[s]=l[s];if(t){r.next=4;break}return r.abrupt("return",o.apply(n,u));case 4:if(u[0],rn(u[1]),c=u[2],f=c.user,d=c.db,!f){r.next=13;break}return r.next=10,d.Users.findById(f.id);case 10:r.t0=r.sent,r.next=14;break;case 13:r.t0=null;case 14:if(r.t0,!f||f.role===t){r.next=17;break}throw new Error("not valid request");case 17:return r.abrupt("return",o.apply(n,u));case 18:case"end":return r.stop()}}),r)})),function(){var e=this,n=arguments;return new Promise((function(t,a){var i=r.apply(e,n);function o(e){tn(i,t,a,o,u,"next",e)}function u(e){tn(i,t,a,o,u,"throw",e)}o(void 0)}))});return function(){return t.apply(this,arguments)}}()}))}}}])&&on(r.prototype,t),a&&on(r,a),n}(d.SchemaDirectiveVisitor),dn={log:function(e){return console.error(e.stack)}},ln=Object(W.makeExecutableSchema)({typeDefs:ae,resolvers:He,schemaDirectives:{isAuth:en,roles:fn},logger:dn}),pn=f.a.model("Users",{firstName:String,lastName:String,email:String,password:String,created:String,modified:String}),vn=f.a.model("Theater",{movieId:String,adult:String,backdrop_path:String,original_language:String,original_title:String,title:String,overview:String,popularity:String,release_date:String,video:String,vote_average:String,vote_count:String,poster_path:String,posters:Array,trailers:Array,genre_ids:Array,isAvailable:Boolean,color:String}),gn=f.a.model("Tokens",{userId:String,token:String,createdAt:String,updatedAt:String}),mn=f.a.model("Reminders",{userId:String,movieId:Object,showable:Boolean,configuration:Object,createdAt:String,updatedAt:String}),hn=f.a.model("Finder",{movieId:String,iMDb:String,adjaranet:Object,iMovie:Object});function bn(e,n,r,t,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?n(s):Promise.resolve(s).then(t,a)}console.log("config",E);var yn=E.MONGO_URL,wn=E.APP_PORT,xn=a()();f.a.connect(yn,{useNewUrlParser:!0,useFindAndModify:!1}),xn.use(o.a.urlencoded({extended:!1})),xn.use(o.a.json()),xn.use(s()()),xn.use(J);var Sn,kn,Rn=f.a.connection;Rn.on("error",console.error.bind(console,"connection error:")),Rn.on("error",console.error.bind(console,"MongoDB connection error:")),Rn.once("open",(function(){return console.log("🗂 MongoDB connected")})),new d.ApolloServer({schema:ln,context:(Sn=regeneratorRuntime.mark((function e(n){var r,t,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.req,e.next=3,L.checkUser(r.headers,{Users:pn,Tokens:gn});case 3:return t=e.sent,e.next=6,L.jsonDecode(r.headers.authorization);case 6:if(e.sent,a={},console.log("tokenCheck:",t),!t.error){e.next=16;break}e.t0=t.type,e.next=2===e.t0?13:3===e.t0?14:15;break;case 13:throw new d.AuthenticationError("Error tokenExp");case 14:throw new d.AuthenticationError("Error on User");case 15:console.log("Default");case 16:return t.error&&0===t.type?(console.warn("Not sign in"),a={Users:pn,Tokens:gn}):t.error&&1===t.type?(console.log("Not valid Token"),a={Users:pn,Tokens:gn}):!t.error&&t.data&&(t.data.role="ADMIN",a={Users:pn,Tokens:gn,Theater:vn,Reminders:mn,FinderModel:hn}),e.abrupt("return",{user:!!t.data&&t.data,db:a});case 18:case"end":return e.stop()}}),e)})),kn=function(){var e=this,n=arguments;return new Promise((function(r,t){var a=Sn.apply(e,n);function i(e){bn(a,r,t,i,o,"next",e)}function o(e){bn(a,r,t,i,o,"throw",e)}i(void 0)}))},function(e){return kn.apply(this,arguments)}),introspection:!0,playground:U.isDevelopment}).applyMiddleware({app:xn,path:"/graphql"}),console.log("process.env.PORT",process.env.PORT),xn.listen(process.env.PORT||wn,(function(){console.log("🚀 LISTENING ON PORT http://localhost:".concat(wn))}))}]);